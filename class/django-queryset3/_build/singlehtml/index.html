<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Functional Programming and Django QuerySets 2016 3 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="None" href="index.html#document-index" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html#document-index">Functional Programming and Django QuerySets 2016 3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="functional-programming-and-django-querysets-2016">
<h1>Functional Programming and Django QuerySets 2016<a class="headerlink" href="#functional-programming-and-django-querysets-2016" title="Permalink to this headline">¶</a></h1>
<p>John Mitchell</p>
<p>SoCal Python</p>
<p>at Media Temple</p>
<p>April 26, 2016</p>
</div>
<div class="section" id="me">
<h1>ME<a class="headerlink" href="#me" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><ul class="simple">
<li>Senior DevOps at TheBlackTux</li>
<li>20 years experience with Python</li>
<li><a class="reference external" href="mailto:john&#37;&#52;&#48;theblacktux&#46;com">john<span>&#64;</span>theblacktux<span>&#46;</span>com</a></li>
<li><a class="reference external" href="mailto:john&#37;&#52;&#48;johntellsall&#46;com">john<span>&#64;</span>johntellsall<span>&#46;</span>com</a></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>first PyCon I went to had 40 people!</li>
</ul>
</div>
</div>
<div class="section" id="id1">
<h1>.<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="figure">
<img alt="_images/TheBlackTux.png" class="fill" src="_images/TheBlackTux.png" />
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Black Tux
Tech Project Manager (and Product Manager)
seasoned UX person
senior Python people
DevOps</p>
</div>
</div>
<div class="section" id="functional-programming-and-django-querysets">
<h1>Functional Programming and Django QuerySets<a class="headerlink" href="#functional-programming-and-django-querysets" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>iterator/generator = &#8220;stream&#8221;</li>
<li>FP: programming with composition</li>
<li>QuerySet is a stream</li>
</ul>
<div class="section" id="practical-advantages-to-fp">
<h2>Practical Advantages to FP<a class="headerlink" href="#practical-advantages-to-fp" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>Modularity</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Composability">Composability!</a></li>
<li>Ease of debugging and testing</li>
<li>Caching</li>
<li>Parallelization</li>
<li>Buzzwordy!</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id2">
<h2>.<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<img alt="_images/there-will-be-code-success-kid.jpg" src="_images/there-will-be-code-success-kid.jpg" />
</div>
</div>
<div class="section" id="iterators">
<h1>Iterators<a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h1>
<div class="section" id="iterator-review">
<h2>Iterator review<a class="headerlink" href="#iterator-review" title="Permalink to this headline">¶</a></h2>
<p>An iterator is a <em>stream</em> of data—sort of a restricted, very
efficient list.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">&lt;listiterator object at 0x7f429d83c750&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>mdash: <a class="reference external" href="http://docutils.sourceforge.net/FAQ.html">http://docutils.sourceforge.net/FAQ.html</a></p>
<p class="last">iterators have a item and next and that&#8217;s it
- Preferred, because they take almost no space</p>
</div>
</div>
<div class="section" id="you-already-use-iterators">
<h2>You already use iterators<a class="headerlink" href="#you-already-use-iterators" title="Permalink to this headline">¶</a></h2>
<p>iterate across a <em>stream</em> of strings</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;recipe.ini&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
<span class="go">    print line</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre># very tasty
[Old Fashioned]
1:1.5 oz whiskey
2:1 tsp water
3:0.5 tsp sugar
4:2 dash bitters
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>you already use iterators</p>
<p class="last">Ex: Database iterator</p>
</div>
</div>
<div class="section" id="lists-iterators-are-very-similar">
<h2>Lists/Iterators are very similar<a class="headerlink" href="#lists-iterators-are-very-similar" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">line</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]):</span>
    <span class="k">print</span> <span class="n">num</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
    <span class="k">print</span> <span class="n">num</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="s">&#39;*.txt&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">name</span>
</pre></div>
</div>
</div>
<div class="section" id="what-can-you-do-with-a-iterator">
<h2>What can you do with a iterator?<a class="headerlink" href="#what-can-you-do-with-a-iterator" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">&#39;# Old Fashioned\n&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">&#39;1.5 oz whiskey\n&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="what-happens-at-the-end">
<h2>What happens at the end?<a class="headerlink" href="#what-happens-at-the-end" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/dev/null&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">StopIteration</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">StopIteration</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([])</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">StopIteration</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">StopIteration</span>
</pre></div>
</div>
</div>
<div class="section" id="what-can-you-not-do-with-an-iterator">
<h2>What can you <em>not</em> do with an iterator?<a class="headerlink" href="#what-can-you-not-do-with-an-iterator" title="Permalink to this headline">¶</a></h2>
<p><strong>no slicing</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;file&#39; object has no attribute &#39;__getitem__&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;file&#39; object has no attribute &#39;__getitem__&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>What can you <em>not</em> do with an iterator?<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p><strong>no length</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">object of type &#39;file&#39; has no len()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">object of type &#39;file&#39; has no len()</span>
</pre></div>
</div>
</div>
<div class="section" id="list-vs-iterator">
<h2>List vs Iterator<a class="headerlink" href="#list-vs-iterator" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="23%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">feature</th>
<th class="head">list</th>
<th class="head">iterator</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>overall</td>
<td>eager</td>
<td>lazy</td>
</tr>
<tr class="row-odd"><td>len(x)</td>
<td>yes</td>
<td>no</td>
</tr>
<tr class="row-even"><td>slice</td>
<td>x[:3]</td>
<td>islice(x, 3)</td>
</tr>
<tr class="row-odd"><td>addition</td>
<td>x + y</td>
<td>chain(x, y)</td>
</tr>
<tr class="row-even"><td>has items</td>
<td>if x</td>
<td>no</td>
</tr>
<tr class="row-odd"><td>easy debug</td>
<td>yes</td>
<td>no</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>List are &#8220;eager&#8221; &#8211; know everything about them all the time</p>
<p>Million item list can be rough, because they hold all million
- have to deal with all items</p>
<p class="last">Million item iter is no biggie, can proc a few</p>
</div>
</div>
<div class="section" id="common-iterator-functions">
<h2>Common iterator functions<a class="headerlink" href="#common-iterator-functions" title="Permalink to this headline">¶</a></h2>
<ul>
<li><dl class="function">
<dt id="enumerate">
<tt class="descname">enumerate</tt><big>(</big><em>iter</em><big>)</big><a class="headerlink" href="#enumerate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</li>
<li><dl class="function">
<dt id="sorted">
<tt class="descname">sorted</tt><big>(</big><em>iter</em><big>)</big><a class="headerlink" href="#sorted" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</li>
<li><dl class="function">
<dt id="range">
<tt class="descname">range</tt><big>(</big><em>stop</em><big>)</big><a class="headerlink" href="#range" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</li>
<li><dl class="function">
<dt id="dict.iteritems">
<tt class="descclassname">dict.</tt><tt class="descname">iteritems</tt><big>(</big><big>)</big><a class="headerlink" href="#dict.iteritems" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</li>
</ul>
<p>very important:</p>
<ul>
<li><dl class="function">
<dt id="filter">
<tt class="descname">filter</tt><big>(</big><em>func/None</em>, <em>iter</em><big>)</big><a class="headerlink" href="#filter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</li>
<li><dl class="function">
<dt id="map">
<tt class="descname">map</tt><big>(</big><em>func</em>, <em>*iterables</em><big>)</big><a class="headerlink" href="#map" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>and <em>itertools</em>, and <em>fileinput</em></p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">XX more here</p>
</div>
</div>
</div>
<div class="section" id="id4">
<h1>☃<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="functional-programming-woot">
<h1>Functional Programming, woot<a class="headerlink" href="#functional-programming-woot" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>iterator/generator = &#8220;stream&#8221;</li>
<li><strong>FP: programming with composition</strong></li>
<li>QuerySet is a stream</li>
</ul>
</div>
<div class="section" id="functional-programming">
<h1>Functional Programming<a class="headerlink" href="#functional-programming" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what">
<h2>what?<a class="headerlink" href="#what" title="Permalink to this headline">¶</a></h2>
<img alt="_images/jimmy-2.jpg" src="_images/jimmy-2.jpg" />
</div>
<div class="section" id="programming-paradigms">
<h2>programming paradigms<a class="headerlink" href="#programming-paradigms" title="Permalink to this headline">¶</a></h2>
<p><em>procedural</em></p>
<blockquote>
<div>list of instructions
can modify caller&#8217;s state</div></blockquote>
<p><em>object oriented</em></p>
<blockquote>
<div>object has state and functions to query/modify state
specialize by subclassing</div></blockquote>
</div>
<div class="section" id="fp-vs-procedural-programming">
<h2>FP vs Procedural programming<a class="headerlink" href="#fp-vs-procedural-programming" title="Permalink to this headline">¶</a></h2>
<p><em>procedural: list of instructions</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">upfile</span><span class="p">(</span><span class="n">inpath</span><span class="p">,</span> <span class="n">outpath</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">inpath</span><span class="p">):</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span>

<span class="n">upfile</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">,</span> <span class="s">&#39;/dev/stdout&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="build simple">
<li>how can you test this?</li>
<li>run in parallel?</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">[Many] Languages are procedural: programs are lists of instructions
that tell the computer what to do with the program’s input.</p>
</div>
</div>
<div class="section" id="fp-vs-object-orientation">
<h2>FP vs Object Orientation<a class="headerlink" href="#fp-vs-object-orientation" title="Permalink to this headline">¶</a></h2>
<p>object oriented: Object has state and specific functions to
query/modify state.  Easy to specialize by subclassing.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RWFile</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inpath</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Upcase</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">inpath</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="p">)</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span>
    <span class="k">def</span> <span class="nf">writelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outpath</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">)</span>

<span class="k">class</span> <span class="nc">UpFile</span><span class="p">(</span><span class="n">RWFile</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="n">UpFile</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s">&#39;/dev/stdout&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Object-oriented programs manipulate collections of objects. Objects
have internal state and support methods that query or modify this
internal state in some way. Smalltalk and Java are object-oriented
languages. C++ and Python are languages that support
object-oriented programming, but don’t force the use of
object-oriented features. [&#8220;Object obsessive&#8221;]</p>
</div>
</div>
<div class="section" id="id5">
<h2>Functional Programming<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>procedural: list of instructions</p>
<blockquote>
<div>object oriented: object has state and specific functions to
query/modify state.  Easy to specialize by subclassing</div></blockquote>
<p>object oriented</p>
<blockquote>
<div>object has state and functions to query/modify state
specialize by subclassing</div></blockquote>
<p><strong>functional</strong></p>
<blockquote>
<div><p><strong>functions operate on streams of objects</strong></p>
<p>preferably without internal state</p>
</div></blockquote>
</div>
<div class="section" id="food-chain">
<h2>food chain<a class="headerlink" href="#food-chain" title="Permalink to this headline">¶</a></h2>
<img alt="_images/FoodChain.jpg" src="_images/FoodChain.jpg" />
</div>
<div class="section" id="example-1-upfile-in-functional-programming">
<h2>Example 1: UpFile in Functional Programming<a class="headerlink" href="#example-1-upfile-in-functional-programming" title="Permalink to this headline">¶</a></h2>
<p>using a generator expression</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">open</span><span class="p">(</span><span class="s">&#39;out.txt&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span>
    <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;in.txt&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">seed, then transforms
recombine elements, vs specialize</p>
</div>
</div>
<div class="section" id="upfile-in-fp-map">
<h2>UpFile in FP: map<a class="headerlink" href="#upfile-in-fp-map" title="Permalink to this headline">¶</a></h2>
<p>specialize with named function and <em>map</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">upcase</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="nb">open</span><span class="p">(</span><span class="s">&#39;out.txt&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span>
    <span class="nb">map</span><span class="p">(</span><span class="n">upcase</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;in.txt&#39;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="map-filter">
<h2>map-filter<a class="headerlink" href="#map-filter" title="Permalink to this headline">¶</a></h2>
<p><strong>map(func, iter)</strong> &#8211; transform items using a function</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="go">[1, 4, 9]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">function applies a passed-in function to
each item in an iterable object and returns a list containing all the
function call results.</p>
</div>
</div>
<div class="section" id="id6">
<h2>map-filter<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p><strong>filter(func, iter)</strong> &#8211; provide items matching a function</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_odd</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">filter</span><span class="p">(</span><span class="n">is_odd</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="go">[1, 3]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The filter filters out items based on a test function which is a
filter and apply functions to pairs of item and running result
which is reduce.</p>
</div>
</div>
<div class="section" id="functional-programming-examples">
<h2>Functional Programming examples<a class="headerlink" href="#functional-programming-examples" title="Permalink to this headline">¶</a></h2>
<p>Example: Windows INI-file parser; aka ConfigParser</p>
<ol class="arabic simple">
<li>stream of lines</li>
<li>stream of valid lines (no comments, has key-value)</li>
<li>stream of key-value match objects</li>
<li>dictionary</li>
</ol>
</div>
<div class="section" id="yum">
<h2>yum<a class="headerlink" href="#yum" title="Permalink to this headline">¶</a></h2>
<img alt="_images/Oldfashioned-cocktail.png" src="_images/Oldfashioned-cocktail.png" />
</div>
<div class="section" id="fp-in-two-step-workflow">
<h2>FP in two step workflow<a class="headerlink" href="#fp-in-two-step-workflow" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 1. stream of lines</span>
<span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;recipe.ini&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">lines</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre># very tasty
[Old Fashioned]
1:1.5 oz whiskey
2:1 tsp water
3:0.5 tsp sugar
4:2 dash bitters
</pre></div>
</div>
</div>
<div class="section" id="fp-workflow-with-ifilter">
<h2>FP workflow with ifilter<a class="headerlink" href="#fp-workflow-with-ifilter" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 2. stream of valid lines</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">def</span> <span class="nf">has_comment</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">has_keyvalue</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span>
<span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;recipe.ini&#39;</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ifilterfalse</span><span class="p">(</span> <span class="n">has_comment</span><span class="p">,</span> <span class="n">lines</span> <span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ifilter</span><span class="p">(</span> <span class="n">has_keyvalue</span><span class="p">,</span> <span class="n">lines</span> <span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">lines</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>1:1.5 oz whiskey
2:1 tsp water
3:0.5 tsp sugar
4:2 dash bitters
</pre></div>
</div>
</div>
<div class="section" id="fp-with-generator-expression-and-ifilter">
<h2>FP with generator expression and ifilter<a class="headerlink" href="#fp-with-generator-expression-and-ifilter" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 3. stream of key-value match objects</span>
<span class="kn">import</span> <span class="nn">fileinput</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">def</span> <span class="nf">has_comment</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">parse_keyvalue</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;(\S+):(.+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">None</span>
<span class="n">matches</span> <span class="o">=</span> <span class="p">(</span><span class="n">parse_keyvalue</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">())</span>
<span class="n">keyvalues</span> <span class="o">=</span> <span class="n">ifilter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kv</span><span class="p">)</span> <span class="k">for</span> <span class="n">kv</span> <span class="ow">in</span> <span class="n">keyvalues</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;1.5 oz whiskey&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;1 tsp water&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="s">&#39;0.5 tsp sugar&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&#39;4&#39;</span><span class="p">,</span> <span class="s">&#39;2 dash bitters&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="fp-with-map-ifilter-dict-output">
<h2>FP with map-ifilter, dict output<a class="headerlink" href="#fp-with-map-ifilter-dict-output" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 4. dictionary</span>
<span class="kn">import</span> <span class="nn">fileinput</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">def</span> <span class="nf">has_comment</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">parse_keyvalue</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;(\S+):(.+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">None</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ifilterfalse</span><span class="p">(</span><span class="n">has_comment</span><span class="p">,</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">())</span>
<span class="n">matches</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">parse_keyvalue</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
<span class="n">keyvalues</span> <span class="o">=</span> <span class="n">ifilter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
<span class="n">confdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">keyvalues</span><span class="p">)</span>
<span class="k">print</span> <span class="n">confdict</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;1&#39;</span><span class="p">:</span> <span class="s">&#39;1.5 oz whiskey&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">:</span> <span class="s">&#39;0.5 tsp sugar&#39;</span><span class="p">,</span>
 <span class="s">&#39;2&#39;</span><span class="p">:</span> <span class="s">&#39;1 tsp water&#39;</span><span class="p">,</span> <span class="s">&#39;4&#39;</span><span class="p">:</span> <span class="s">&#39;2 dash bitters&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h2><a class="reference external" href="https://docs.python.org/2/library/itertools.html">itertools</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<table class="hlist"><tr><td><ul class="simple">
<li><strong>chain()</strong></li>
<li>compress()</li>
<li>count()</li>
<li>cycle()</li>
<li>dropwhile()</li>
<li>groupby()</li>
<li><strong>ifilter()</strong></li>
<li>ifilterfalse()</li>
</ul>
</td><td><ul class="simple">
<li><strong>imap()</strong></li>
<li><strong>islice()</strong></li>
<li><strong>izip()</strong></li>
<li>izip_longest()</li>
<li>repeat()</li>
<li>starmap()</li>
<li>takewhile()</li>
<li>tee()</li>
</ul>
</td></tr></table>
</div>
<div class="section" id="chain-only-for-iterators">
<h2>chain &#8211; only for iterators<a class="headerlink" href="#chain-only-for-iterators" title="Permalink to this headline">¶</a></h2>
<p><strong>chain(iter*)</strong> gives elements of each stream in order
Equivalent to <strong>+</strong> for lists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chain</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">3</span><span class="p">]))</span>
<span class="go">&lt;itertools.chain object at 0x7f429d848510&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">stream of objects with state
lazy vs eager</p>
</div>
</div>
<div class="section" id="islice-similar-to-list">
<h2>islice &#8211; similar to list<a class="headerlink" href="#islice-similar-to-list" title="Permalink to this headline">¶</a></h2>
<p><strong>islice(iter, num)</strong> &#8211; return first few items</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])[:</span><span class="mi">2</span><span class="p">]</span>
<span class="go">[1,2]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])[:</span><span class="mi">2</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;listiterator&#39; object has no attribute &#39;__getitem__&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;listiterator&#39; object has no attribute &#39;__getitem__&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;itertools.islice object at 0x7f429d7de9f0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://docs.python.org/dev/howto/functional.html">https://docs.python.org/dev/howto/functional.html</a></p>
</div>
</div>
</div>
<div class="section" id="id8">
<h1>☃<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="django-querysets">
<h1>Django QuerySets<a class="headerlink" href="#django-querysets" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>iterator/generator = &#8220;stream&#8221;</li>
<li>FP: programming with composition</li>
<li><strong>QuerySet is a stream</strong> of rows from the database</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>models.py</p>
<p>source: <a class="reference external" href="http://blog.etianen.com/blog/2013/06/08/django-querysets/">http://blog.etianen.com/blog/2013/06/08/django-querysets/</a></p>
<p>QuerySets are Django&#8217;s way of getting and updating data</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="go">class Meeting(models.Model):</span>
<span class="go">name = models.CharField(max_length=100)</span>
<span class="go">meet_date = models.DateTimeField()</span>
</pre></div>
</div>
</div>
<div class="section" id="queryset-review">
<h2>QuerySet review<a class="headerlink" href="#queryset-review" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="go">&lt;Meeting: Meeting object&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">__dict__</span>
<span class="go">{&#39;meet_date&#39;: datetime.datetime(2014, 5, 20, 7, 0, tzinfo=&lt;UTC&gt;),</span>
<span class="go">&#39;_state&#39;: &lt;django.db.models.base.ModelState object at 0x2bd1050&gt;,</span>
<span class="go">&#39;id&#39;: 3, &#39;name&#39;: u&#39;LA Django Monthly Meeting&#39;}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="s">&#39;go&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span> <span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span>
<span class="go">LA Django Monthly Meeting</span>
</pre></div>
</div>
</div>
<div class="section" id="queryset-and-iterators">
<h2>QuerySet and iterators<a class="headerlink" href="#queryset-and-iterators" title="Permalink to this headline">¶</a></h2>
<p>QuerySets can be shifty</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;java&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;class &#39;django.db.models.query.QuerySet&#39;&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="functional-querysets">
<h1>Functional QuerySets<a class="headerlink" href="#functional-querysets" title="Permalink to this headline">¶</a></h1>
<p>How can you tell if a list is empty or not?</p>
<blockquote>
<div><ul class="simple">
<li>an iterator?</li>
<li>a QuerySet?</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="empty-list">
<h1>Empty List?<a class="headerlink" href="#empty-list" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>How can you tell if a list is empty or not?</em></p>
</div>
<div class="section" id="a-empty-list">
<h2>A: Empty List<a class="headerlink" href="#a-empty-list" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">([])</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">([</span><span class="s">&#39;beer&#39;</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lists are <em>eager</em> &#8211; always know everything</p>
</div>
</div>
</div>
<div class="section" id="empty-iterator">
<h1>Empty Iterator?<a class="headerlink" href="#empty-iterator" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>How can you tell if an iterator is empty or not?</em></p>
</div>
<div class="section" id="a-empty-iterator">
<h2>A: Empty Iterator<a class="headerlink" href="#a-empty-iterator" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="nb">iter</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Iterators are <em>lazy</em> &#8211; don&#8217;t know what they contain!</p>
</div>
</div>
</div>
<div class="section" id="how-can-you-tell-if-a-queryset-is-empty-or-not">
<h1>How can you tell if a QuerySet is empty or not?<a class="headerlink" href="#how-can-you-tell-if-a-queryset-is-empty-or-not" title="Permalink to this headline">¶</a></h1>
<div class="section" id="queryset-like-iterator">
<h2>QuerySet like Iterator<a class="headerlink" href="#queryset-like-iterator" title="Permalink to this headline">¶</a></h2>
<p>filter with QuerySet:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meetup.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
<p>filter with list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="p">[{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}])</span>
<span class="go">[{&#39;id&#39;: 1}]</span>
</pre></div>
</div>
<p>filter with iterator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ifilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="nb">iter</span><span class="p">([{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}])))</span>
<span class="go">[{&#39;id&#39;: 1}]</span>
</pre></div>
</div>
</div>
<div class="section" id="because-queryset-is-an-iterator">
<h2>Because QuerySet <em>is</em> an iterator<a class="headerlink" href="#because-queryset-is-an-iterator" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meetup.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="go">&lt;class &#39;django.db.models.query.QuerySet&#39;&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>similar to iter: dynamic/lazy; list(qs)</p>
<p>diff: stream of objs, same class
qs[:3] &lt;=&gt; islice(it, 3)
bool(iter) vs qs.empty()</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="nb">iter</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="p">[]</span> <span class="p">;</span> <span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>qs.count()</p>
<p>laziness is explicit: prefetch_related</p>
<p class="last">qs.values(); qs.values_list(); qs.values-list(flat=True)</p>
</div>
</div>
<div class="section" id="can-mix-match-qs-iterators">
<h2>Can mix/match QS/iterators...<a class="headerlink" href="#can-mix-match-qs-iterators" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;itertools.islice object at 0x2bb9ec0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">))</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
</div>
<div class="section" id="but-not-always">
<h2>...but not always<a class="headerlink" href="#but-not-always" title="Permalink to this headline">¶</a></h2>
<p><em>How can you tell if a QuerySet is empty or not?</em></p>
<p>Use x.exists(), not bool(x) &#8211; <a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/models/querysets/">more efficient</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Both iterators and QuerySets are <em>lazy</em></p>
<p>In functional programming, we have functions which operate on infinite-length streams.</p>
<p>With QuerySets, it&#8217;s assumed we have many thousands of results, but we don&#8217;t want to fetch all of them at once before returning to caller.</p>
<p>Database (and Django) does a query, then gives us a few items.  Once that batch is done, QuerySet will ask the database for another batch of results.</p>
<p class="last">This means that for both iterators and query sets, we can do a
little work, then process a batch, without waiting for the entire
list of results.</p>
</div>
</div>
</div>
<div class="section" id="ideas">
<h1>IDEAS<a class="headerlink" href="#ideas" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>iterator/generator = &#8220;stream&#8221;</li>
<li>FP: programming with composition</li>
<li>QuerySet is a stream</li>
</ul>
</div>
<div class="questions section" id="questions">
<h1>Questions?<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h1>
<div class="figure">
<img alt="_images/john-bold.jpg" class="fill" src="_images/john-bold.jpg" />
<p class="caption"><a class="reference external" href="mailto:john&#37;&#52;&#48;johntellsall&#46;com">john<span>&#64;</span>johntellsall<span>&#46;</span>com</a></p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>Can Your Programming Language Do This? by Joel Spolsky</p>
<p><a class="reference external" href="http://www.joelonsoftware.com/items/2006/08/01.html">http://www.joelonsoftware.com/items/2006/08/01.html</a></p>
<p>Wikipedia: Functional Programming</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Functional_programming">http://en.wikipedia.org/wiki/Functional_programming</a></p>
<p>Functional Programming HOWTO by Andy Kuchling</p>
<p><a class="reference external" href="https://docs.python.org/2/howto/functional.html">https://docs.python.org/2/howto/functional.html</a></p>
<p>Using Django querysets effectively by Dave Hall</p>
<p>(best blog title ever)</p>
<p><a class="reference external" href="http://blog.etianen.com/blog/2013/06/08/django-querysets/">http://blog.etianen.com/blog/2013/06/08/django-querysets/</a></p>
</div>
</div>
<div class="section" id="django-querysets-and-functional-programming">
<h1>Django QuerySets and Functional Programming<a class="headerlink" href="#django-querysets-and-functional-programming" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="mailto:john&#37;&#52;&#48;johntellsall&#46;com">john<span>&#64;</span>johntellsall<span>&#46;</span>com</a></p>
<p>v2</p>
</div>
<div class="section" id="theme">
<h1>THEME<a class="headerlink" href="#theme" title="Permalink to this headline">¶</a></h1>
<p>By using techniques from Functional Programming, we can
make modular, reliable and testable code, faster.</p>
</div>
<div class="section" id="id9">
<h1>ME<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><ul class="simple">
<li>Senior dev/server guy; Devops</li>
<li>15 years experience with Python</li>
<li>first PyCon I went to had 40 people!</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Functional Programming &lt;funcprog&gt;
FP in Python &lt;fp_python&gt;
querysets
Patterns and Consequences &lt;pat_conseq&gt;
summary</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">stream of objects with state
lazy vs eager
Heisenberg
<strong>************************************************************</strong></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">figure:: /_static/3-hoodlums-nancy.png
slide:: Three Programming Paradigms</p>
</div>
</div>
<div class="section" id="why-functional-programming">
<h1>Why Functional Programming<a class="headerlink" href="#why-functional-programming" title="Permalink to this headline">¶</a></h1>
<div class="section" id="practical-advantages-to-functional-programming">
<h2>Practical Advantages to Functional Programming<a class="headerlink" href="#practical-advantages-to-functional-programming" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>Modularity</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Composability">Composability!</a></li>
<li>Ease of debugging and testing</li>
<li>Caching</li>
<li>Parallelization</li>
</ul>
</div></blockquote>
<ul class="build simple">
<li>Buzzwordy!</li>
<li>Chicks dig it!</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">add &#8220;happy girl with beads&#8221; image</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Data streams from function to function &#8211; no side effects.</p>
<p class="last">read Andy Kuchling&#8217;s <a class="reference external" href="https://docs.python.org/2.7/howto/functional.html">Functional Programming HOWTO</a></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Functional programming decomposes a problem into a set of
functions. Ideally, functions only take inputs and produce outputs,
and don’t have any internal state that affects the output produced
for a given input.</p>
<p>Eliminating side effects, i.e. changes in state that do not depend
on the function inputs, can make it much easier to understand and
predict the behavior of a program</p>
<p class="last"><a class="reference external" href="http://en.wikipedia.org/wiki/Functional_programming">http://en.wikipedia.org/wiki/Functional_programming</a></p>
</div>
</div>
<div class="section" id="id11">
<h2>Iterators<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>An iterator is a <em>stream</em> of data &#8211; sort of a restricted, very
efficient list</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">&lt;listiterator object at 0x7f429d83c750&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">iterators have a item and next and that&#8217;s it
- Preferred, because they take almost no space</p>
</div>
</div>
<div class="section" id="file-iterator">
<h2>File iterator<a class="headerlink" href="#file-iterator" title="Permalink to this headline">¶</a></h2>
<p>iterate across a <em>stream</em> of strings</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;beer.txt&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">line</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">you already use iterators</p>
</div>
</div>
<div class="section" id="list-very-similar-to-iterator">
<h2>List very similar to Iterator<a class="headerlink" href="#list-very-similar-to-iterator" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">line</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]):</span>
    <span class="k">print</span> <span class="n">num</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
    <span class="k">print</span> <span class="n">num</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;*.txt&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">name</span>
</pre></div>
</div>
<p>Work with a <em>stream</em> of objects</p>
</div>
<div class="section" id="fp-upcase">
<h2>FP: upcase<a class="headerlink" href="#fp-upcase" title="Permalink to this headline">¶</a></h2>
<p>functional: functions operate on streams of objects</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">upcase</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">writelines</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">line</span> <span class="p">)</span>

<span class="n">writelines</span><span class="p">(</span> <span class="s">&#39;/dev/stdout&#39;</span><span class="p">,</span>
            <span class="n">upcase</span><span class="p">(</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="p">)</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="fp-upcase-2">
<h2>FP: upcase 2<a class="headerlink" href="#fp-upcase-2" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">upcase</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="c"># IN: stream of lines; OUT: stream of lines</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">writelines</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
    <span class="c"># IN: stream of lines; OUT: nothing</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">line</span> <span class="p">)</span>

<span class="c"># open() is OUT: stream of lines</span>
<span class="n">writelines</span><span class="p">(</span> <span class="s">&#39;/dev/stdout&#39;</span><span class="p">,</span>
            <span class="n">upcase</span><span class="p">(</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="p">)</span>
            <span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generally you&#8217;ll mix these styles. IE: function that returns
a stream of objects.
<strong>************************************************************</strong></p>
</div>
</div>
</div>
<div class="section" id="functional-programming-in-python">
<h1>Functional Programming in Python<a class="headerlink" href="#functional-programming-in-python" title="Permalink to this headline">¶</a></h1>
<div class="section" id="old-primary-functions">
<h2>Old Primary Functions<a class="headerlink" href="#old-primary-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">filter</tt><big>(</big><em>function</em>, <em>iterable</em><big>)</big></dt>
<dd><p>Construct a <strong>list</strong> from those elements of iterable for which function returns true.</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">map</tt><big>(</big><em>function</em>, <em>iterable</em>, <em>...</em><big>)</big></dt>
<dd><p>Apply function to every item of iterable and return a <strong>list</strong> of the results.</p>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If additional iterable arguments are passed, function must
take that many arguments and is applied to the items from
all iterables in parallel. If one iterable is shorter than
another it is assumed to be extended with None items. If
function is None, the identity function is assumed; if there
are multiple arguments, map() returns a list consisting of
tuples containing the corresponding items from all iterables
(a kind of transpose operation). The iterable arguments may
be a sequence or any iterable object; the result is always a
list.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="function">
<dt id="reduce">
<tt class="descname">reduce</tt><big>(</big><em>function</em>, <em>iterable</em><span class="optional">[</span>, <em>initializer</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#reduce" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p class="last">Apply function of two arguments cumulatively to the items of iterable, from left to right, so as to reduce the iterable to a single value.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="function">
<dt>
<tt class="descname">enumerate</tt><big>(</big><em>sequence</em><span class="optional">[</span>, <em>start=0</em><span class="optional">]</span><big>)</big></dt>
<dd></dd></dl>

<p class="last">Return an iterator that yields tuples of an index and an item of the
<em>sequence</em>. (And so on.)</p>
</div>
</div>
<div class="section" id="fp-important-dataset">
<h2>FP: important dataset<a class="headerlink" href="#fp-important-dataset" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
<span class="go"># Old Fashioned</span>
<span class="go">1.5 oz whiskey</span>
<span class="go">1 tsp water</span>
<span class="go">0.5 tsp sugar</span>
<span class="go">2 dash bitters</span>
</pre></div>
</div>
</div>
<div class="section" id="functional-prog-for-better-booze">
<h2>Functional Prog for Better Booze!<a class="headerlink" href="#functional-prog-for-better-booze" title="Permalink to this headline">¶</a></h2>
<div class="figure">
<img alt="_images/Oldfashioned-cocktail.png" src="_images/Oldfashioned-cocktail.png" />
<p class="caption">CC PD <a class="reference external" href="http://en.wikipedia.org/wiki/File:Oldfashioned-cocktail.png">http://en.wikipedia.org/wiki/File:Oldfashioned-cocktail.png</a></p>
</div>
</div>
<div class="section" id="fp-filter">
<h2>FP: filter<a class="headerlink" href="#fp-filter" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">isdata</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return not line.startswith(&#39;#&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">filter</span><span class="p">(</span><span class="n">isdata</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">))</span> <span class="p">)</span>
<span class="go">1.5 oz whiskey</span>
<span class="go">1 tsp water</span>
<span class="go">0.5 tsp sugar</span>
<span class="go">2 dash bitters</span>
</pre></div>
</div>
<dl class="function">
<dt>
<tt class="descname">filter</tt><big>(</big><em>function</em>, <em>iterable</em><big>)</big></dt>
<dd><p>Construct a <strong>list</strong> from those elements of iterable for which function returns true.</p>
</dd></dl>

</div>
<div class="section" id="fp-map-filter">
<h2>FP: map, filter<a class="headerlink" href="#fp-map-filter" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">amount</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return str(line.split()[:2])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">isdata</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return not line.startswith(&#39;#&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="n">isdata</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)))</span> <span class="p">)</span>
<span class="go">[&#39;1.5&#39;, &#39;oz&#39;]</span>
<span class="go">[&#39;1&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;0.5&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;2&#39;, &#39;dash&#39;]</span>
</pre></div>
</div>
<dl class="function">
<dt>
<tt class="descname">map</tt><big>(</big><em>function</em>, <em>iterable</em>, <em>...</em><big>)</big></dt>
<dd><p>Apply function to every item of iterable and return a <strong>list</strong> of the results.</p>
</dd></dl>

</div>
<div class="section" id="preferred-generator-expressions">
<h2>Preferred: generator expressions<a class="headerlink" href="#preferred-generator-expressions" title="Permalink to this headline">¶</a></h2>
<p><strong>filter replacement</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;whiskey&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>compare with</strong></p>
<p><em>filter(function, iterable)</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">high performance, memory efficient generalization of list comprehensions [1] and generators [2].
<a class="reference external" href="http://legacy.python.org/dev/peps/pep-0289/">http://legacy.python.org/dev/peps/pep-0289/</a></p>
</div>
</div>
<div class="section" id="preferred-filter-replacement">
<h2>Preferred: filter replacement<a class="headerlink" href="#preferred-filter-replacement" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;whiskey&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
<span class="go">&lt;generator object &lt;genexpr&gt; at 0x7f429d7c8eb0&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="convert-to-list-so-we-can-see">
<h2>convert to list so we can see<a class="headerlink" href="#convert-to-list-so-we-can-see" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">list</span><span class="p">((</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;whiskey&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span><span class="o">**</span><span class="p">)</span>
<span class="go">[&#39;1.5 oz whiskey\n&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="original-fp-1">
<h2>original FP #1<a class="headerlink" href="#original-fp-1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">isdata</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return not line.startswith(&#39;#&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">amount</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return str(line.split()[:2])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="n">isdata</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)))</span> <span class="p">)</span>
<span class="go">[&#39;1.5&#39;, &#39;oz&#39;]</span>
<span class="go">[&#39;1&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;0.5&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;2&#39;, &#39;dash&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="updated-fp-1">
<h2>updated FP #1<a class="headerlink" href="#updated-fp-1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">isdata</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return not line.startswith(&#39;#&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">amount</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return str(line.split()[:2])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">(</span>
<span class="go">    amount(hasdata)</span>
<span class="go">    for hasdata in (</span>
<span class="go">        line for line in open(&#39;ing.txt&#39;)</span>
<span class="go">            if isdata(line)</span>
<span class="go">    )</span>
<span class="go">) )</span>
<span class="go">[&#39;1.5&#39;, &#39;oz&#39;]</span>
<span class="go">[&#39;1&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;0.5&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;2&#39;, &#39;dash&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="iter-chain">
<h2>iter: chain<a class="headerlink" href="#iter-chain" title="Permalink to this headline">¶</a></h2>
<p><strong>chain(streams)</strong> gives elements of each stream in order
Equivalent to <strong>+</strong> for lists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chain</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">3</span><span class="p">]))</span>
<span class="go">&lt;itertools.chain object at 0x7f429d848510&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span> <span class="n">chain</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">3</span><span class="p">]))</span> <span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">stream of objects with state
lazy vs eager
<strong>************************************************************</strong></p>
</div>
</div>
<div class="section" id="iter-islice">
<h2>iter: islice<a class="headerlink" href="#iter-islice" title="Permalink to this headline">¶</a></h2>
<p><strong>islice(stream, num)</strong> &#8211; get counted elements of stream
Equivalent to slice operator for lists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])[:</span><span class="mi">1</span><span class="p">]</span>
<span class="go">[2]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])[:</span><span class="mi">1</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;listiterator&#39; object has no attribute &#39;__getitem__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;itertools.islice object at 0x7f429d7de9f0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">[1, 2]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;listiterator&#39; object has no attribute &#39;__getitem__&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id12">
<h1>Django QuerySets<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h1>
<p>QuerySets are Django&#8217;s way of getting and updating data</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>models.py</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="go">class Meeting(models.Model):</span>
<span class="go">name = models.CharField(max_length=100)</span>
<span class="go">meet_date = models.DateTimeField()</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h2>QuerySet review<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="go">&lt;Meeting: Meeting object&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">__dict__</span>
<span class="go">{&#39;meet_date&#39;: datetime.datetime(2014, 5, 20, 7, 0, tzinfo=&lt;UTC&gt;),</span>
<span class="go">&#39;_state&#39;: &lt;django.db.models.base.ModelState object at 0x2bd1050&gt;,</span>
<span class="go">&#39;id&#39;: 3, &#39;name&#39;: u&#39;LA Django Monthly Meeting&#39;}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="s">&#39;go&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span> <span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span>
<span class="go">LA Django Monthly Meeting</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h2>QuerySet and iterators<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;java&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;class &#39;django.db.models.query.QuerySet&#39;&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id15">
<h1>Functional QuerySets<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h1>
<p class="build">How can you tell if a list is empty or not?</p>
<p class="build">. an iterator?</p>
<p class="build">. a QuerySet?</p>
<div class="section" id="id16">
<h2>Empty List<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<p><em>How can you tell if a list is empty or not?</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">([])</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">([</span><span class="s">&#39;beer&#39;</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lists are <em>eager</em> &#8211; always know everything</p>
</div>
</div>
<div class="section" id="id17">
<h2>Empty Iterator<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<p><em>How can you tell if an iterator is empty or not?</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="nb">iter</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Iterators are <em>lazy</em> &#8211; don&#8217;t know what they contain!</p>
</div>
</div>
</div>
<div class="section" id="id18">
<h1>How can you tell if a QuerySet is empty or not?<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id19">
<h2>QuerySet like Iterator<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<p>filter returning QuerySet:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meetup.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
<p>filter returning list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="p">[{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}])</span>
<span class="go">[{&#39;id&#39;: 1}]</span>
</pre></div>
</div>
<p>filter returning iterator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ifilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="nb">iter</span><span class="p">([{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}])))</span>
<span class="go">[{&#39;id&#39;: 1}]</span>
</pre></div>
</div>
</div>
<div class="section" id="id20">
<h2>Because QuerySet <em>is</em> an iterator<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meetup.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="go">&lt;class &#39;django.db.models.query.QuerySet&#39;&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>similar to iter: dynamic/lazy; list(qs)</p>
<p>diff: stream of objs, same class
qs[:3] &lt;=&gt; islice(it, 3)
bool(iter) vs qs.empty()</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="nb">iter</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="p">[]</span> <span class="p">;</span> <span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>qs.count()</p>
<p>laziness is explicit: prefetch_related</p>
<p class="last">qs.values(); qs.values_list(); qs.values-list(flat=True)</p>
</div>
</div>
<div class="section" id="can-mix-and-match">
<h2>Can mix and match<a class="headerlink" href="#can-mix-and-match" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;itertools.islice object at 0x2bb9ec0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">))</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
</div>
<div class="section" id="id21">
<h2>But not always<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<p><em>How can you tell if a QuerySet is empty or not?</em></p>
<p>Use <cite>x.exists()</cite>, not <cite>bool(x)</cite> &#8211; more efficient</p>
<dl class="docutils">
<dt><strong>x.exists()</strong></dt>
<dd>database query to find any matches</dd>
<dt><strong>bool(x)</strong></dt>
<dd>retrieve matches, have Python count if any</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>some_queryset.exists() will do more overall work (one query for the existence check plus an extra one to later retrieve the results) than simply using bool(some_queryset), which retrieves the results and then checks if any were returned.</p>
<p>Both iterators and QuerySets are <em>lazy</em></p>
<p>In functional programming, we have functions which operate on infinite-length streams.</p>
<p>With QuerySets, it&#8217;s assumed we have many thousands of results, but we don&#8217;t want to fetch all of them at once before returning to caller.</p>
<p>Database (and Django) does a query, then gives us a few items.  Once that batch is done, QuerySet will ask the database for another batch of results.</p>
<p class="last">This means that for both iterators and query sets, we can do a
little work, then process a batch, without waiting for the entire
list of results.</p>
</div>
</div>
<div class="section" id="programmers-use-lots-of-tools">
<h2>Programmers use lots of tools<a class="headerlink" href="#programmers-use-lots-of-tools" title="Permalink to this headline">¶</a></h2>
<img alt="_images/large_BaxterCutawayFF3.jpg" src="_images/large_BaxterCutawayFF3.jpg" />
</div>
</div>
<div class="section" id="id22">
<h1>Questions?<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h1>
<div class="figure">
<img alt="_images/john-bold.jpg" class="fill" src="_images/john-bold.jpg" />
<p class="caption"><a class="reference external" href="mailto:john&#37;&#52;&#48;johntellsall&#46;com">john<span>&#64;</span>johntellsall<span>&#46;</span>com</a></p>
</div>
<div class="section" id="id23">
<h2>References<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<p>Can Your Programming Language Do This? by Joel Spolsky</p>
<p><a class="reference external" href="http://www.joelonsoftware.com/items/2006/08/01.html">http://www.joelonsoftware.com/items/2006/08/01.html</a></p>
<p>Wikipedia: Functional Programming</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Functional_programming">http://en.wikipedia.org/wiki/Functional_programming</a></p>
<p>Functional Programming HOWTO by Andy Kuchling</p>
<p><a class="reference external" href="https://docs.python.org/2/howto/functional.html">https://docs.python.org/2/howto/functional.html</a></p>
<p>Using Django querysets effectively by Dave Hall</p>
<p><a class="reference external" href="http://blog.etianen.com/blog/2013/06/08/django-querysets/">http://blog.etianen.com/blog/2013/06/08/django-querysets/</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html#document-index">Functional Programming and Django QuerySets 2016 3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, John Mitchell.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>