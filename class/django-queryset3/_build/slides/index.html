<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Functional Programming and Django QuerySets 2016 &mdash; Functional Programming and Django QuerySets 2016 3 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="_static/single.css" type="text/css" />
    

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/common.js"></script>
    <script type="text/javascript" src="_static/slides.js"></script>
    <script type="text/javascript" src="_static/sync.js"></script>
    <script type="text/javascript" src="_static/controller.js"></script>
    <script type="text/javascript" src="_static/init.js"></script>
    
    <link rel="top" title="Functional Programming and Django QuerySets 2016 3 documentation" href="#" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  <article class="slide level-1" id="functional-programming-and-django-querysets-2016">
<h1>Functional Programming and Django QuerySets 2016</h1>
<p>John Mitchell</p>
<p>SoCal Python</p>
<p>at Media Temple</p>
<p>April 26, 2016</p>

</article>
<article class="slide level-1" id="me">
<h1>ME</h1>
<blockquote>
<div><ul class="simple">
<li>beer</li>
<li>Senior dev/server guy; DevOps</li>
<li>20 years experience with Python</li>
<li><a class="reference external" href="mailto:john&#37;&#52;&#48;theblacktux&#46;com">john<span>&#64;</span>theblacktux<span>&#46;</span>com</a></li>
<li><a class="reference external" href="mailto:john&#37;&#52;&#48;johntellsall&#46;com">john<span>&#64;</span>johntellsall<span>&#46;</span>com</a></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>first PyCon I went to had 40 people!</li>
</ul>
</div>

</article>
<article class="slide level-1" id="id1">
<h1>.</h1>
<div class="figure">
<img alt="_images/TheBlackTux.png" class="fill" src="_images/TheBlackTux.png" />
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Black Tux
Tech Project Manager (and Product Manager)
seasoned UX person
senior Python people
DevOps</p>
</div>

</article>
<article class="slide level-1" id="functional-programming-and-django-querysets">
<h1>Functional Programming and Django QuerySets</h1>
<ul class="simple">
<li>iterator/generator = &quot;stream&quot;</li>
<li>FP: programming with composition</li>
<li>QuerySet is a stream</li>
</ul>

</article>
<article class="slide level-2" id="id2">
<h2>.</h2>
<img alt="_images/there-will-be-code-success-kid.jpg" src="_images/there-will-be-code-success-kid.jpg" />

</article>
<article class="slide level-1" id="iterators">
<h1>Iterators</h1>

</article>
<article class="slide level-2" id="iterator-review">
<h2>Iterator review</h2>
<p>An iterator is a <em>stream</em> of dataâ€”sort of a restricted, very
efficient list.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">&lt;listiterator object at 0x7f429d83c750&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>mdash: <a class="reference external" href="http://docutils.sourceforge.net/FAQ.html">http://docutils.sourceforge.net/FAQ.html</a></p>
<p class="last">iterators have a item and next and that's it
- Preferred, because they take almost no space</p>
</div>

</article>
<article class="slide level-2" id="you-already-use-iterators">
<h2>You already use iterators</h2>
<p>iterate across a <em>stream</em> of strings</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;recipe.ini&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
<span class="go">    print line</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre># very tasty
[Old Fashioned]
1:1.5 oz whiskey
2:1 tsp water
3:0.5 tsp sugar
4:2 dash bitters
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>you already use iterators</p>
<p class="last">Ex: Database iterator</p>
</div>

</article>
<article class="slide level-2" id="lists-iterators-are-very-similar">
<h2>Lists/Iterators are very similar</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">line</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]):</span>
    <span class="k">print</span> <span class="n">num</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
    <span class="k">print</span> <span class="n">num</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="s">&#39;*.txt&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">name</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="what-can-you-do-with-a-iterator">
<h2>What can you do with a iterator?</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">&#39;# Old Fashioned\n&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">&#39;1.5 oz whiskey\n&#39;</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="what-happens-at-the-end">
<h2>What happens at the end?</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/dev/null&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">StopIteration</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">StopIteration</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([])</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">StopIteration</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">StopIteration</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="what-can-you-not-do-with-an-iterator">
<h2>What can you <em>not</em> do with an iterator?</h2>
<p><strong>no slicing</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;file&#39; object has no attribute &#39;__getitem__&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;file&#39; object has no attribute &#39;__getitem__&#39;</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="id3">
<h2>What can you <em>not</em> do with an iterator?</h2>
<p><strong>no length</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">object of type &#39;file&#39; has no len()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">object of type &#39;file&#39; has no len()</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="list-vs-iterator">
<h2>List vs Iterator</h2>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="23%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">feature</th>
<th class="head">list</th>
<th class="head">iterator</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>overall</td>
<td>eager</td>
<td>lazy</td>
</tr>
<tr class="row-odd"><td>len(x)</td>
<td>yes</td>
<td>no</td>
</tr>
<tr class="row-even"><td>slice</td>
<td>x[:3]</td>
<td>islice(x, 3)</td>
</tr>
<tr class="row-odd"><td>addition</td>
<td>x + y</td>
<td>chain(x, y)</td>
</tr>
<tr class="row-even"><td>has items</td>
<td>if x</td>
<td>no</td>
</tr>
<tr class="row-odd"><td>easy debug</td>
<td>yes</td>
<td>no</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>List are &quot;eager&quot; -- know everything about them all the time</p>
<p>Million item list can be rough, because they hold all million
- have to deal with all items</p>
<p class="last">Million item iter is no biggie, can proc a few</p>
</div>

</article>
<article class="slide level-2" id="common-iterator-functions">
<h2>Common iterator functions</h2>
<ul>
<li><dl class="function">
<dt id="enumerate">
<tt class="descname">enumerate</tt><big>(</big><em>iter</em><big>)</big></dt>
<dd></dd></dl>

</li>
<li><dl class="function">
<dt id="sorted">
<tt class="descname">sorted</tt><big>(</big><em>iter</em><big>)</big></dt>
<dd></dd></dl>

</li>
<li><dl class="function">
<dt id="range">
<tt class="descname">range</tt><big>(</big><em>stop</em><big>)</big></dt>
<dd></dd></dl>

</li>
<li><dl class="function">
<dt id="dict.iteritems">
<tt class="descclassname">dict.</tt><tt class="descname">iteritems</tt><big>(</big><big>)</big></dt>
<dd></dd></dl>

</li>
</ul>
<p>very important:</p>
<ul>
<li><dl class="function">
<dt id="filter">
<tt class="descname">filter</tt><big>(</big><em>func/None</em>, <em>iter</em><big>)</big></dt>
<dd></dd></dl>

</li>
<li><dl class="function">
<dt id="map">
<tt class="descname">map</tt><big>(</big><em>func</em>, <em>*iterables</em><big>)</big></dt>
<dd></dd></dl>

<p>and <em>itertools</em>, and <em>fileinput</em></p>
</li>
</ul>
<p>XX &quot;will be code&quot; meme image</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">XX more here</p>
</div>

</article>
<article class="slide level-1" id="id4">
<h1>â˜ƒ</h1>

</article>
<article class="slide level-1" id="functional-programming">
<h1>Functional Programming</h1>

</article>
<article class="slide level-2" id="what">
<h2>what?</h2>
<img alt="_images/jimmy-2.jpg" src="_images/jimmy-2.jpg" />

</article>
<article class="slide level-2" id="programming-paradigms">
<h2>programming paradigms</h2>
<p><em>procedural</em></p>
<blockquote>
<div>list of instructions
can modify caller's state</div></blockquote>
<p><em>object oriented</em></p>
<blockquote>
<div>object has state and functions to query/modify state
specialize by subclassing</div></blockquote>

</article>
<article class="slide level-2" id="fp-vs-procedural-programming">
<h2>FP vs Procedural programming</h2>
<p><em>procedural: list of instructions</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">upfile</span><span class="p">(</span><span class="n">inpath</span><span class="p">,</span> <span class="n">outpath</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">inpath</span><span class="p">):</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span>

<span class="n">upfile</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">,</span> <span class="s">&#39;/dev/stdout&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="build simple">
<li>how can you test this?</li>
<li>run in parallel?</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">[Many] Languages are procedural: programs are lists of instructions
that tell the computer what to do with the programâ€™s input.</p>
</div>

</article>
<article class="slide level-2" id="fp-vs-object-orientation">
<h2>FP vs Object Orientation</h2>
<p>object oriented: Object has state and specific functions to
query/modify state.  Easy to specialize by subclassing.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RWFile</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inpath</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Upcase</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">inpath</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="p">)</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span>
    <span class="k">def</span> <span class="nf">writelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outpath</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">)</span>

<span class="k">class</span> <span class="nc">UpFile</span><span class="p">(</span><span class="n">RWFile</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="n">UpFile</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s">&#39;/dev/stdout&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Object-oriented programs manipulate collections of objects. Objects
have internal state and support methods that query or modify this
internal state in some way. Smalltalk and Java are object-oriented
languages. C++ and Python are languages that support
object-oriented programming, but donâ€™t force the use of
object-oriented features. [&quot;Object obsessive&quot;]</p>
</div>

</article>
<article class="slide level-2" id="id5">
<h2>Functional Programming</h2>
<p>procedural: list of instructions</p>
<blockquote>
<div>object oriented: object has state and specific functions to
query/modify state.  Easy to specialize by subclassing</div></blockquote>
<p>object oriented</p>
<blockquote>
<div>object has state and functions to query/modify state
specialize by subclassing</div></blockquote>
<p><strong>functional</strong></p>
<blockquote>
<div><p><strong>functions operate on streams of objects</strong></p>
<p>preferably without internal state</p>
</div></blockquote>

</article>
<article class="slide level-2" id="food-chain">
<h2>food chain</h2>
<img alt="_images/FoodChain.jpg" src="_images/FoodChain.jpg" />

</article>
<article class="slide level-2" id="example-1-upfile-in-functional-programming">
<h2>Example 1: UpFile in Functional Programming</h2>
<p>using a generator expression</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">open</span><span class="p">(</span><span class="s">&#39;out.txt&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span>
    <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;in.txt&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">seed, then transforms
recombine elements, vs specialize</p>
</div>

</article>
<article class="slide level-2" id="upfile-in-fp-map">
<h2>UpFile in FP: map</h2>
<p>specialize with named function and <em>map</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">upcase</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="nb">open</span><span class="p">(</span><span class="s">&#39;out.txt&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span>
    <span class="nb">map</span><span class="p">(</span><span class="n">upcase</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;in.txt&#39;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="map-filter">
<h2>map-filter</h2>
<p><strong>map(func, iter)</strong> -- transform items using a function</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="go">[1, 4, 9]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">function applies a passed-in function to
each item in an iterable object and returns a list containing all the
function call results.</p>
</div>

</article>
<article class="slide level-2" id="id6">
<h2>map-filter</h2>
<p><strong>filter(func, iter)</strong> -- provide items matching a function</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_odd</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">filter</span><span class="p">(</span><span class="n">is_odd</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="go">[1, 3]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The filter filters out items based on a test function which is a
filter and apply functions to pairs of item and running result
which is reduce.</p>
</div>

</article>
<article class="slide level-2" id="imap-ifilter">
<h2>imap-ifilter</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">itertools</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">itertools</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">&lt;itertools.imap at 0x7fc004e6bb50&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
<span class="go">[1, 4]</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="functional-programming-examples">
<h2>Functional Programming examples</h2>
<p>Example: Windows INI-file parser; aka ConfigParser</p>
<ol class="arabic simple">
<li>stream of lines</li>
<li>stream of valid lines (no comments, has key-value)</li>
<li>stream of key-value match objects</li>
<li>dictionary</li>
</ol>

</article>
<article class="slide level-2" id="yum">
<h2>yum</h2>
<img alt="_images/Oldfashioned-cocktail.png" src="_images/Oldfashioned-cocktail.png" />

</article>
<article class="slide level-2" id="fp-in-two-step-workflow">
<h2>FP in two step workflow</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 1. stream of lines</span>
<span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;recipe.ini&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">lines</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre># very tasty
[Old Fashioned]
1:1.5 oz whiskey
2:1 tsp water
3:0.5 tsp sugar
4:2 dash bitters
</pre></div>
</div>

</article>
<article class="slide level-2" id="fp-workflow-with-ifilter">
<h2>FP workflow with ifilter</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 2. stream of valid lines</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">def</span> <span class="nf">has_comment</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">has_keyvalue</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span>
<span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;recipe.ini&#39;</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ifilterfalse</span><span class="p">(</span> <span class="n">has_comment</span><span class="p">,</span> <span class="n">lines</span> <span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ifilter</span><span class="p">(</span> <span class="n">has_keyvalue</span><span class="p">,</span> <span class="n">lines</span> <span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">lines</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>1:1.5 oz whiskey
2:1 tsp water
3:0.5 tsp sugar
4:2 dash bitters
</pre></div>
</div>

</article>
<article class="slide level-2" id="fp-with-generator-expression-and-ifilter">
<h2>FP with generator expression and ifilter</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 3. stream of key-value match objects</span>
<span class="kn">import</span> <span class="nn">fileinput</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">def</span> <span class="nf">has_comment</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">parse_keyvalue</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;(\S+):(.+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">None</span>
<span class="n">matches</span> <span class="o">=</span> <span class="p">(</span><span class="n">parse_keyvalue</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">())</span>
<span class="n">keyvalues</span> <span class="o">=</span> <span class="n">ifilter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kv</span><span class="p">)</span> <span class="k">for</span> <span class="n">kv</span> <span class="ow">in</span> <span class="n">keyvalues</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;1.5 oz whiskey&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;1 tsp water&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="s">&#39;0.5 tsp sugar&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&#39;4&#39;</span><span class="p">,</span> <span class="s">&#39;2 dash bitters&#39;</span><span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="fp-with-map-ifilter-dict-output">
<h2>FP with map-ifilter, dict output</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 4. dictionary</span>
<span class="kn">import</span> <span class="nn">fileinput</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">def</span> <span class="nf">has_comment</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">parse_keyvalue</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;(\S+):(.+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">None</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ifilterfalse</span><span class="p">(</span><span class="n">has_comment</span><span class="p">,</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">())</span>
<span class="n">matches</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">parse_keyvalue</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
<span class="n">keyvalues</span> <span class="o">=</span> <span class="n">ifilter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
<span class="n">confdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">keyvalues</span><span class="p">)</span>
<span class="k">print</span> <span class="n">confdict</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;1&#39;</span><span class="p">:</span> <span class="s">&#39;1.5 oz whiskey&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">:</span> <span class="s">&#39;0.5 tsp sugar&#39;</span><span class="p">,</span>
 <span class="s">&#39;2&#39;</span><span class="p">:</span> <span class="s">&#39;1 tsp water&#39;</span><span class="p">,</span> <span class="s">&#39;4&#39;</span><span class="p">:</span> <span class="s">&#39;2 dash bitters&#39;</span><span class="p">}</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="id7">
<h2><a class="reference external" href="https://docs.python.org/2/library/itertools.html">itertools</a></h2>
<table class="hlist"><tr><td><ul class="simple">
<li><strong>chain()</strong></li>
<li>compress()</li>
<li>count()</li>
<li>cycle()</li>
<li>dropwhile()</li>
<li>groupby()</li>
<li><strong>ifilter()</strong></li>
<li>ifilterfalse()</li>
</ul>
</td><td><ul class="simple">
<li><strong>imap()</strong></li>
<li><strong>islice()</strong></li>
<li><strong>izip()</strong></li>
<li>izip_longest()</li>
<li>repeat()</li>
<li>starmap()</li>
<li>takewhile()</li>
<li>tee()</li>
</ul>
</td></tr></table>

</article>
<article class="slide level-2" id="chain-only-for-iterators">
<h2>chain -- only for iterators</h2>
<p><strong>chain(iter*)</strong> gives elements of each stream in order
Equivalent to <strong>+</strong> for lists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chain</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">3</span><span class="p">]))</span>
<span class="go">&lt;itertools.chain object at 0x7f429d848510&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">stream of objects with state
lazy vs eager</p>
</div>

</article>
<article class="slide level-2" id="islice-similar-to-list">
<h2>islice -- similar to list</h2>
<p><strong>islice(iter, num)</strong> -- return first few items</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])[:</span><span class="mi">2</span><span class="p">]</span>
<span class="go">[1,2]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])[:</span><span class="mi">2</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;listiterator&#39; object has no attribute &#39;__getitem__&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;listiterator&#39; object has no attribute &#39;__getitem__&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;itertools.islice object at 0x7f429d7de9f0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://docs.python.org/dev/howto/functional.html">https://docs.python.org/dev/howto/functional.html</a></p>
</div>

</article>
<article class="slide level-2" id="practical-advantages-to-fp">
<h2>Practical Advantages to FP</h2>
<blockquote>
<div><ul class="simple">
<li>Modularity</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Composability">Composability!</a></li>
<li>Ease of debugging and testing</li>
<li>Caching</li>
<li>Parallelization</li>
<li>Buzzwordy!</li>
</ul>
</div></blockquote>

</article>
<article class="slide level-1" id="id8">
<h1>â˜ƒ</h1>

</article>
<article class="slide level-1" id="django-querysets">
<h1>Django QuerySets</h1>
<ul class="simple">
<li>iterator/generator = &quot;stream&quot;</li>
<li>FP: programming with composition</li>
<li><strong>QuerySet is a stream</strong></li>
</ul>
<p>represents a <em>stream</em> of rows from the database</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>models.py</p>
<p>source: <a class="reference external" href="http://blog.etianen.com/blog/2013/06/08/django-querysets/">http://blog.etianen.com/blog/2013/06/08/django-querysets/</a></p>
<p>QuerySets are Django's way of getting and updating data</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="go">class Meeting(models.Model):</span>
<span class="go">name = models.CharField(max_length=100)</span>
<span class="go">meet_date = models.DateTimeField()</span>
</pre></div>
</div>
</div>

</article>
<article class="slide level-2" id="queryset-review">
<h2>QuerySet review</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="go">&lt;Meeting: Meeting object&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">__dict__</span>
<span class="go">{&#39;meet_date&#39;: datetime.datetime(2014, 5, 20, 7, 0, tzinfo=&lt;UTC&gt;),</span>
<span class="go">&#39;_state&#39;: &lt;django.db.models.base.ModelState object at 0x2bd1050&gt;,</span>
<span class="go">&#39;id&#39;: 3, &#39;name&#39;: u&#39;LA Django Monthly Meeting&#39;}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="s">&#39;go&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span> <span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span>
<span class="go">LA Django Monthly Meeting</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="queryset-and-iterators">
<h2>QuerySet and iterators</h2>
<p>QuerySets can be shifty</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;java&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;class &#39;django.db.models.query.QuerySet&#39;&gt;</span>
</pre></div>
</div>

</article>
<article class="slide level-1" id="functional-querysets">
<h1>Functional QuerySets</h1>
<p>How can you tell if a list is empty or not?</p>
<blockquote>
<div><ul class="simple">
<li>an iterator?</li>
<li>a QuerySet?</li>
</ul>
</div></blockquote>

</article>
<article class="slide level-1" id="empty-list">
<h1>Empty List?</h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>How can you tell if a list is empty or not?</em></p>
</div>

</article>
<article class="slide level-2" id="a-empty-list">
<h2>A: Empty List</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">([])</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">([</span><span class="s">&#39;beer&#39;</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lists are <em>eager</em> -- always know everything</p>
</div>

</article>
<article class="slide level-1" id="empty-iterator">
<h1>Empty Iterator?</h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>How can you tell if an iterator is empty or not?</em></p>
</div>

</article>
<article class="slide level-2" id="a-empty-iterator">
<h2>A: Empty Iterator</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="nb">iter</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Iterators are <em>lazy</em> -- don't know what they contain!</p>
</div>

</article>
<article class="slide level-1" id="how-can-you-tell-if-a-queryset-is-empty-or-not">
<h1>How can you tell if a QuerySet is empty or not?</h1>

</article>
<article class="slide level-2" id="queryset-like-iterator">
<h2>QuerySet like Iterator</h2>
<p>filter with QuerySet:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meetup.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
<p>filter with list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="p">[{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}])</span>
<span class="go">[{&#39;id&#39;: 1}]</span>
</pre></div>
</div>
<p>filter with iterator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ifilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="nb">iter</span><span class="p">([{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}])))</span>
<span class="go">[{&#39;id&#39;: 1}]</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="because-queryset-is-an-iterator">
<h2>Because QuerySet <em>is</em> an iterator</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meetup.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="go">&lt;class &#39;django.db.models.query.QuerySet&#39;&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>similar to iter: dynamic/lazy; list(qs)</p>
<p>diff: stream of objs, same class
qs[:3] &lt;=&gt; islice(it, 3)
bool(iter) vs qs.empty()</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="nb">iter</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="p">[]</span> <span class="p">;</span> <span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>qs.count()</p>
<p>laziness is explicit: prefetch_related</p>
<p class="last">qs.values(); qs.values_list(); qs.values-list(flat=True)</p>
</div>

</article>
<article class="slide level-2" id="can-mix-match-qs-iterators">
<h2>Can mix/match QS/iterators...</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;itertools.islice object at 0x2bb9ec0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">))</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="but-not-always">
<h2>...but not always</h2>
<p><em>How can you tell if a QuerySet is empty or not?</em></p>
<p>Use x.exists(), not bool(x) -- <a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/models/querysets/">more efficient</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Both iterators and QuerySets are <em>lazy</em></p>
<p>In functional programming, we have functions which operate on infinite-length streams.</p>
<p>With QuerySets, it's assumed we have many thousands of results, but we don't want to fetch all of them at once before returning to caller.</p>
<p>Database (and Django) does a query, then gives us a few items.  Once that batch is done, QuerySet will ask the database for another batch of results.</p>
<p class="last">This means that for both iterators and query sets, we can do a
little work, then process a batch, without waiting for the entire
list of results.</p>
</div>

</article>
<article class="slide level-1" id="ideas">
<h1>IDEAS</h1>
<p>iterator/generator = &quot;stream&quot;</p>
<p>FP: functions operate on streams of immutable objects</p>
<p>QuerySet is a stream</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">programming with composition</p>
</div>

</article>
<article class="questions slide level-1" id="questions">
<h1>Questions?</h1>
<div class="figure">
<img alt="_images/john-bold.jpg" class="fill" src="_images/john-bold.jpg" />
<p class="caption"><a class="reference external" href="mailto:john&#37;&#52;&#48;johntellsall&#46;com">john<span>&#64;</span>johntellsall<span>&#46;</span>com</a></p>
</div>

</article>
<article class="slide level-2" id="references">
<h2>References</h2>
<p>Can Your Programming Language Do This? by Joel Spolsky</p>
<p><a class="reference external" href="http://www.joelonsoftware.com/items/2006/08/01.html">http://www.joelonsoftware.com/items/2006/08/01.html</a></p>
<p>Wikipedia: Functional Programming</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Functional_programming">http://en.wikipedia.org/wiki/Functional_programming</a></p>
<p>Functional Programming HOWTO by Andy Kuchling</p>
<p><a class="reference external" href="https://docs.python.org/2/howto/functional.html">https://docs.python.org/2/howto/functional.html</a></p>
<p>Using Django querysets effectively by Dave Hall</p>
<p>(best blog title ever)</p>
<p><a class="reference external" href="http://blog.etianen.com/blog/2013/06/08/django-querysets/">http://blog.etianen.com/blog/2013/06/08/django-querysets/</a></p>

</article>
<article class="slide level-1" id="django-querysets-and-functional-programming">
<h1>Django QuerySets and Functional Programming</h1>
<p><a class="reference external" href="mailto:john&#37;&#52;&#48;johntellsall&#46;com">john<span>&#64;</span>johntellsall<span>&#46;</span>com</a></p>
<p>v2</p>

</article>
<article class="slide level-1" id="theme">
<h1>THEME</h1>
<p>By using techniques from Functional Programming, we can
make modular, reliable and testable code, faster.</p>

</article>
<article class="slide level-1" id="id9">
<h1>ME</h1>
<blockquote>
<div><ul class="simple">
<li>Senior dev/server guy; Devops</li>
<li>15 years experience with Python</li>
<li>first PyCon I went to had 40 people!</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Functional Programming &lt;funcprog&gt;
FP in Python &lt;fp_python&gt;
querysets
Patterns and Consequences &lt;pat_conseq&gt;
summary</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">stream of objects with state
lazy vs eager
Heisenberg
<strong>************************************************************</strong></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">figure:: /_static/3-hoodlums-nancy.png
slide:: Three Programming Paradigms</p>
</div>

</article>
<article class="slide level-1" id="why-functional-programming">
<h1>Why Functional Programming</h1>

</article>
<article class="slide level-2" id="practical-advantages-to-functional-programming">
<h2>Practical Advantages to Functional Programming</h2>
<blockquote>
<div><ul class="simple">
<li>Modularity</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Composability">Composability!</a></li>
<li>Ease of debugging and testing</li>
<li>Caching</li>
<li>Parallelization</li>
</ul>
</div></blockquote>
<ul class="build simple">
<li>Buzzwordy!</li>
<li>Chicks dig it!</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">add &quot;happy girl with beads&quot; image</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Data streams from function to function -- no side effects.</p>
<p class="last">read Andy Kuchling's <a class="reference external" href="https://docs.python.org/2.7/howto/functional.html">Functional Programming HOWTO</a></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Functional programming decomposes a problem into a set of
functions. Ideally, functions only take inputs and produce outputs,
and donâ€™t have any internal state that affects the output produced
for a given input.</p>
<p>Eliminating side effects, i.e. changes in state that do not depend
on the function inputs, can make it much easier to understand and
predict the behavior of a program</p>
<p class="last"><a class="reference external" href="http://en.wikipedia.org/wiki/Functional_programming">http://en.wikipedia.org/wiki/Functional_programming</a></p>
</div>

</article>
<article class="slide level-2" id="id11">
<h2>Iterators</h2>
<p>An iterator is a <em>stream</em> of data -- sort of a restricted, very
efficient list</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">&lt;listiterator object at 0x7f429d83c750&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">iterators have a item and next and that's it
- Preferred, because they take almost no space</p>
</div>

</article>
<article class="slide level-2" id="file-iterator">
<h2>File iterator</h2>
<p>iterate across a <em>stream</em> of strings</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;beer.txt&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">line</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">you already use iterators</p>
</div>

</article>
<article class="slide level-2" id="list-very-similar-to-iterator">
<h2>List very similar to Iterator</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">line</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]):</span>
    <span class="k">print</span> <span class="n">num</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
    <span class="k">print</span> <span class="n">num</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;*.txt&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">name</span>
</pre></div>
</div>
<p>Work with a <em>stream</em> of objects</p>

</article>
<article class="slide level-2" id="fp-upcase">
<h2>FP: upcase</h2>
<p>functional: functions operate on streams of objects</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">upcase</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">writelines</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">line</span> <span class="p">)</span>

<span class="n">writelines</span><span class="p">(</span> <span class="s">&#39;/dev/stdout&#39;</span><span class="p">,</span>
            <span class="n">upcase</span><span class="p">(</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="p">)</span>
            <span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="fp-upcase-2">
<h2>FP: upcase 2</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">upcase</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="c"># IN: stream of lines; OUT: stream of lines</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">writelines</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
    <span class="c"># IN: stream of lines; OUT: nothing</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">line</span> <span class="p">)</span>

<span class="c"># open() is OUT: stream of lines</span>
<span class="n">writelines</span><span class="p">(</span> <span class="s">&#39;/dev/stdout&#39;</span><span class="p">,</span>
            <span class="n">upcase</span><span class="p">(</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="p">)</span>
            <span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generally you'll mix these styles. IE: function that returns
a stream of objects.
<strong>************************************************************</strong></p>
</div>

</article>
<article class="slide level-1" id="functional-programming-in-python">
<h1>Functional Programming in Python</h1>

</article>
<article class="slide level-2" id="old-primary-functions">
<h2>Old Primary Functions</h2>
<dl class="function">
<dt>
<tt class="descname">filter</tt><big>(</big><em>function</em>, <em>iterable</em><big>)</big></dt>
<dd><p>Construct a <strong>list</strong> from those elements of iterable for which function returns true.</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">map</tt><big>(</big><em>function</em>, <em>iterable</em>, <em>...</em><big>)</big></dt>
<dd><p>Apply function to every item of iterable and return a <strong>list</strong> of the results.</p>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">map</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If additional iterable arguments are passed, function must
take that many arguments and is applied to the items from
all iterables in parallel. If one iterable is shorter than
another it is assumed to be extended with None items. If
function is None, the identity function is assumed; if there
are multiple arguments, map() returns a list consisting of
tuples containing the corresponding items from all iterables
(a kind of transpose operation). The iterable arguments may
be a sequence or any iterable object; the result is always a
list.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="function">
<dt id="reduce">
<tt class="descname">reduce</tt><big>(</big><em>function</em>, <em>iterable</em><span class="optional">[</span>, <em>initializer</em><span class="optional">]</span><big>)</big></dt>
<dd></dd></dl>

<p class="last">Apply function of two arguments cumulatively to the items of iterable, from left to right, so as to reduce the iterable to a single value.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="function">
<dt>
<tt class="descname">enumerate</tt><big>(</big><em>sequence</em><span class="optional">[</span>, <em>start=0</em><span class="optional">]</span><big>)</big></dt>
<dd></dd></dl>

<p class="last">Return an iterator that yields tuples of an index and an item of the
<em>sequence</em>. (And so on.)</p>
</div>

</article>
<article class="slide level-2" id="fp-important-dataset">
<h2>FP: important dataset</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
<span class="go"># Old Fashioned</span>
<span class="go">1.5 oz whiskey</span>
<span class="go">1 tsp water</span>
<span class="go">0.5 tsp sugar</span>
<span class="go">2 dash bitters</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="functional-prog-for-better-booze">
<h2>Functional Prog for Better Booze!</h2>
<div class="figure">
<img alt="_images/Oldfashioned-cocktail.png" src="_images/Oldfashioned-cocktail.png" />
<p class="caption">CC PD <a class="reference external" href="http://en.wikipedia.org/wiki/File:Oldfashioned-cocktail.png">http://en.wikipedia.org/wiki/File:Oldfashioned-cocktail.png</a></p>
</div>

</article>
<article class="slide level-2" id="fp-filter">
<h2>FP: filter</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">isdata</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return not line.startswith(&#39;#&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">filter</span><span class="p">(</span><span class="n">isdata</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">))</span> <span class="p">)</span>
<span class="go">1.5 oz whiskey</span>
<span class="go">1 tsp water</span>
<span class="go">0.5 tsp sugar</span>
<span class="go">2 dash bitters</span>
</pre></div>
</div>
<dl class="function">
<dt>
<tt class="descname">filter</tt><big>(</big><em>function</em>, <em>iterable</em><big>)</big></dt>
<dd><p>Construct a <strong>list</strong> from those elements of iterable for which function returns true.</p>
</dd></dl>


</article>
<article class="slide level-2" id="fp-map-filter">
<h2>FP: map, filter</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">amount</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return str(line.split()[:2])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">isdata</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return not line.startswith(&#39;#&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="n">isdata</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)))</span> <span class="p">)</span>
<span class="go">[&#39;1.5&#39;, &#39;oz&#39;]</span>
<span class="go">[&#39;1&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;0.5&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;2&#39;, &#39;dash&#39;]</span>
</pre></div>
</div>
<dl class="function">
<dt>
<tt class="descname">map</tt><big>(</big><em>function</em>, <em>iterable</em>, <em>...</em><big>)</big></dt>
<dd><p>Apply function to every item of iterable and return a <strong>list</strong> of the results.</p>
</dd></dl>


</article>
<article class="slide level-2" id="preferred-generator-expressions">
<h2>Preferred: generator expressions</h2>
<p><strong>filter replacement</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;whiskey&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>compare with</strong></p>
<p><em>filter(function, iterable)</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">high performance, memory efficient generalization of list comprehensions [1] and generators [2].
<a class="reference external" href="http://legacy.python.org/dev/peps/pep-0289/">http://legacy.python.org/dev/peps/pep-0289/</a></p>
</div>

</article>
<article class="slide level-2" id="preferred-filter-replacement">
<h2>Preferred: filter replacement</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;whiskey&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
<span class="go">&lt;generator object &lt;genexpr&gt; at 0x7f429d7c8eb0&gt;</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="convert-to-list-so-we-can-see">
<h2>convert to list so we can see</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">list</span><span class="p">((</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;whiskey&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span><span class="o">**</span><span class="p">)</span>
<span class="go">[&#39;1.5 oz whiskey\n&#39;]</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="original-fp-1">
<h2>original FP #1</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">isdata</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return not line.startswith(&#39;#&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">amount</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return str(line.split()[:2])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="n">isdata</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)))</span> <span class="p">)</span>
<span class="go">[&#39;1.5&#39;, &#39;oz&#39;]</span>
<span class="go">[&#39;1&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;0.5&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;2&#39;, &#39;dash&#39;]</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="updated-fp-1">
<h2>updated FP #1</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">isdata</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return not line.startswith(&#39;#&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">amount</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="go">    return str(line.split()[:2])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">(</span>
<span class="go">    amount(hasdata)</span>
<span class="go">    for hasdata in (</span>
<span class="go">        line for line in open(&#39;ing.txt&#39;)</span>
<span class="go">            if isdata(line)</span>
<span class="go">    )</span>
<span class="go">) )</span>
<span class="go">[&#39;1.5&#39;, &#39;oz&#39;]</span>
<span class="go">[&#39;1&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;0.5&#39;, &#39;tsp&#39;]</span>
<span class="go">[&#39;2&#39;, &#39;dash&#39;]</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="iterator-functions">
<h2>Iterator Functions</h2>
<dl class="function">
<dt id="xrange">
<tt class="descname">xrange</tt><big>(</big><em>stop) -&gt; counter (xrange object</em><big>)</big></dt>
<dd></dd></dl>

<dl class="function">
<dt>
<tt class="descname">xrange</tt><big>(</big><em>start</em>, <em>stop</em><span class="optional">[</span>, <em>step</em><span class="optional">]</span><big>)</big> &rarr; counter</dt>
<dd></dd></dl>

<dl class="function">
<dt id="chain">
<tt class="descname">chain</tt><big>(</big><em>*iterables</em><big>)</big> &rarr; each item in order</dt>
<dd></dd></dl>

<dl class="function">
<dt id="ifilter">
<tt class="descname">ifilter</tt><big>(</big><em>f</em>, <em>iter</em><big>)</big> &rarr; substream of iter. Like filter, for iterators.</dt>
<dd></dd></dl>

<dl class="function">
<dt id="islice">
<tt class="descname">islice</tt><big>(</big><em>iter</em>, <em>num</em><big>)</big> &rarr; counted items of iter</dt>
<dd></dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="last function">
<dt id="imap">
<tt class="descname">imap</tt><big>(</big><em>func</em>, <em>p</em>, <em>q</em><big>)</big> &rarr; f(p), f(q), ...</dt>
<dd><dl class="function">
<dt>
<tt class="descname">izip()     p, q, ...       (p[0], q[0]), (p[1], q[1]), ... izip('ABCD', 'xy') --&gt; Ax By</tt></dt>
<dt>
<tt class="descname">.. py:function:: izip_longest()    p, q, ...       (p[0], q[0]), (p[1], q[1]), ... izip_longest('ABCD', 'xy', fillvalue='-') --&gt; Ax By C- D-</tt></dt>
<dd></dd></dl>

</dd></dl>

</div>

</article>
<article class="slide level-2" id="iter-chain">
<h2>iter: chain</h2>
<p><strong>chain(streams)</strong> gives elements of each stream in order
Equivalent to <strong>+</strong> for lists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chain</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">3</span><span class="p">]))</span>
<span class="go">&lt;itertools.chain object at 0x7f429d848510&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span> <span class="n">chain</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">3</span><span class="p">]))</span> <span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">stream of objects with state
lazy vs eager
<strong>************************************************************</strong></p>
</div>

</article>
<article class="slide level-2" id="iter-islice">
<h2>iter: islice</h2>
<p><strong>islice(stream, num)</strong> -- get counted elements of stream
Equivalent to slice operator for lists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])[:</span><span class="mi">1</span><span class="p">]</span>
<span class="go">[2]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])[:</span><span class="mi">1</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;listiterator&#39; object has no attribute &#39;__getitem__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">&lt;itertools.islice object at 0x7f429d7de9f0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">[1, 2]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;listiterator&#39; object has no attribute &#39;__getitem__&#39;</span>
</pre></div>
</div>

</article>
<article class="slide level-1" id="id12">
<h1>Django QuerySets</h1>
<p>QuerySets are Django's way of getting and updating data</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>models.py</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="go">class Meeting(models.Model):</span>
<span class="go">name = models.CharField(max_length=100)</span>
<span class="go">meet_date = models.DateTimeField()</span>
</pre></div>
</div>
</div>

</article>
<article class="slide level-2" id="id13">
<h2>QuerySet review</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="go">&lt;Meeting: Meeting object&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">__dict__</span>
<span class="go">{&#39;meet_date&#39;: datetime.datetime(2014, 5, 20, 7, 0, tzinfo=&lt;UTC&gt;),</span>
<span class="go">&#39;_state&#39;: &lt;django.db.models.base.ModelState object at 0x2bd1050&gt;,</span>
<span class="go">&#39;id&#39;: 3, &#39;name&#39;: u&#39;LA Django Monthly Meeting&#39;}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="s">&#39;go&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span> <span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span>
<span class="go">LA Django Monthly Meeting</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="id14">
<h2>QuerySet and iterators</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;java&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;class &#39;django.db.models.query.QuerySet&#39;&gt;</span>
</pre></div>
</div>

</article>
<article class="slide level-1" id="id15">
<h1>Functional QuerySets</h1>
<p class="build">How can you tell if a list is empty or not?</p>
<p class="build">. an iterator?</p>
<p class="build">. a QuerySet?</p>

</article>
<article class="slide level-2" id="id16">
<h2>Empty List</h2>
<p><em>How can you tell if a list is empty or not?</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">([])</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">([</span><span class="s">&#39;beer&#39;</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lists are <em>eager</em> -- always know everything</p>
</div>

</article>
<article class="slide level-2" id="id17">
<h2>Empty Iterator</h2>
<p><em>How can you tell if an iterator is empty or not?</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">=</span><span class="nb">iter</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Iterators are <em>lazy</em> -- don't know what they contain!</p>
</div>

</article>
<article class="slide level-1" id="id18">
<h1>How can you tell if a QuerySet is empty or not?</h1>

</article>
<article class="slide level-2" id="id19">
<h2>QuerySet like Iterator</h2>
<p>filter with QuerySet:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meetup.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
<p>filter with list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="p">[{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}])</span>
<span class="go">[{&#39;id&#39;: 1}]</span>
</pre></div>
</div>
<p>filter with iterator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ifilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="nb">iter</span><span class="p">([{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}])))</span>
<span class="go">[{&#39;id&#39;: 1}]</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="id20">
<h2>Because QuerySet <em>is</em> an iterator</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meetup.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="go">&lt;class &#39;django.db.models.query.QuerySet&#39;&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>similar to iter: dynamic/lazy; list(qs)</p>
<p>diff: stream of objs, same class
qs[:3] &lt;=&gt; islice(it, 3)
bool(iter) vs qs.empty()</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="nb">iter</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="p">[]</span> <span class="p">;</span> <span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>qs.count()</p>
<p>laziness is explicit: prefetch_related</p>
<p class="last">qs.values(); qs.values_list(); qs.values-list(flat=True)</p>
</div>

</article>
<article class="slide level-2" id="can-mix-and-match">
<h2>Can mix and match</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;itertools.islice object at 0x2bb9ec0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span> <span class="n">Meeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="mi">1</span><span class="p">))</span>
<span class="go">[&lt;Meeting: Meeting object&gt;]</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="id21">
<h2>But not always</h2>
<p><em>How can you tell if a QuerySet is empty or not?</em></p>
<p>Use x.exists(), not bool(x) -- more efficient</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Both iterators and QuerySets are <em>lazy</em></p>
<p>In functional programming, we have functions which operate on infinite-length streams.</p>
<p>With QuerySets, it's assumed we have many thousands of results, but we don't want to fetch all of them at once before returning to caller.</p>
<p>Database (and Django) does a query, then gives us a few items.  Once that batch is done, QuerySet will ask the database for another batch of results.</p>
<p class="last">This means that for both iterators and query sets, we can do a
little work, then process a batch, without waiting for the entire
list of results.</p>
</div>

</article>
<article class="slide level-1" id="id22">
<h1>Questions?</h1>
<div class="figure">
<img alt="_images/john-bold.jpg" class="fill" src="_images/john-bold.jpg" />
<p class="caption"><a class="reference external" href="mailto:john&#37;&#52;&#48;johntellsall&#46;com">john<span>&#64;</span>johntellsall<span>&#46;</span>com</a></p>
</div>

</article>
<article class="slide level-2" id="id23">
<h2>References</h2>
<p>Can Your Programming Language Do This? by Joel Spolsky</p>
<p><a class="reference external" href="http://www.joelonsoftware.com/items/2006/08/01.html">http://www.joelonsoftware.com/items/2006/08/01.html</a></p>
<p>Wikipedia: Functional Programming</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Functional_programming">http://en.wikipedia.org/wiki/Functional_programming</a></p>
<p>Functional Programming HOWTO by Andy Kuchling</p>
<p><a class="reference external" href="https://docs.python.org/2/howto/functional.html">https://docs.python.org/2/howto/functional.html</a></p>
<p>Using Django querysets effectively by Dave Hall</p>
<p><a class="reference external" href="http://blog.etianen.com/blog/2013/06/08/django-querysets/">http://blog.etianen.com/blog/2013/06/08/django-querysets/</a></p>

</article>
<article class="slide level-2" id="historical">
<h2>HISTORICAL</h2>

</article>
<article class="slide level-2" id="database-iterator">
<h2>Database iterator</h2>
<p>iterate with a <em>stream</em> of rows</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sqlite3</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;recipe&#39;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;&quot;&quot;select name from ingredient&quot;&quot;&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="fp-lisp-style-with-generator-expressions">
<h2>FP: Lisp style with generator expressions</h2>
<p>XX</p>
<p><em>print list of ingredients in a recipe</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="nb">map</span><span class="p">(</span><span class="n">ing_name</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span>
               <span class="nb">map</span><span class="p">(</span><span class="n">parse_ing</span><span class="p">,</span>
                   <span class="nb">open</span><span class="p">(</span><span class="s">&#39;oldfashioned.ini&#39;</span><span class="p">)</span>
               <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">))</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="fp-lisp-style-with-map-filter">
<h2>FP: Lisp style with map-filter</h2>
<p><em>print list of ingredients in a recipe</em></p>
<p>XX</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="nb">map</span><span class="p">(</span><span class="n">ing_name</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span>
         <span class="nb">map</span><span class="p">(</span><span class="n">parse_ing</span><span class="p">,</span>
             <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
         <span class="p">)</span>
     <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="ex2-print-list-of-ingredients-in-a-recipe">
<h2>Ex2: print list of ingredients in a recipe</h2>
<p><strong>oldfashioned.ini</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre># very tasty
[Old Fashioned]
1:1.5 oz whiskey
2:1 tsp water
3:0.5 tsp sugar
4:2 dash bitters
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">whiskey</span>
<span class="n">water</span>
<span class="n">sugar</span>
<span class="n">bitters</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="ex2-procedural-style">
<h2>Ex2: procedural style</h2>
<p><em>print list of ingredients in a recipe</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ingredients</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;oldfashioned.ini&#39;</span><span class="p">):</span>
    <span class="n">ing</span> <span class="o">=</span> <span class="n">parse_ing</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ing</span><span class="p">:</span>
        <span class="n">ingredients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ing</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ingredients</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="last docutils">
<dt>def parse_ing(line):</dt>
<dd>return re.match(r'[0-9].+s(?P&lt;name&gt;w+)', line)</dd>
</dl>
</div>

</article>
<article class="slide level-2" id="fp-generator-expressions">
<h2>FP: generator expressions</h2>
<p><em>print list of ingredients in a recipe</em></p>
<p>XX</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="nb">map</span><span class="p">(</span><span class="n">ing_name</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span>
         <span class="nb">map</span><span class="p">(</span><span class="n">parse_ing</span><span class="p">,</span>
             <span class="nb">open</span><span class="p">(</span><span class="s">&#39;ing.txt&#39;</span><span class="p">)</span>
         <span class="p">)</span>
     <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

</article>
<article class="slide level-2" id="programmers-use-lots-of-tools">
<h2>Programmers use lots of tools</h2>
<img alt="_images/large_BaxterCutawayFF3.jpg" src="_images/large_BaxterCutawayFF3.jpg" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">XX hide RHS</p>
</div>

</article>


</section>

<section id="slide_notes">

</section>

  </body>
</html>